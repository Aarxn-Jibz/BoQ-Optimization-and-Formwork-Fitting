{"ast":null,"code":"import { MOCK_OPTIMIZATION_RESULT, RUN_HISTORY, INVENTORY_DATA } from '../data/constants.js';\nconst MOCK_MODE = true; // ← set false when Go server is running\nconst BASE = 'http://localhost:3000';\nconst TIMEOUT = 30000;\nconst ENDPOINTS = {\n  OPTIMIZE: '/api/optimize-kitting',\n  HISTORY: '/api/history',\n  INVENTORY: '/api/inventory',\n  HEALTH: '/api/health'\n};\nasync function apiFetch(endpoint, options = {}) {\n  const controller = new AbortController();\n  const timer = setTimeout(() => controller.abort(), TIMEOUT);\n  try {\n    const res = await fetch(`${BASE}${endpoint}`, {\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      signal: controller.signal,\n      ...options\n    });\n    clearTimeout(timer);\n    if (!res.ok) {\n      const err = await res.json().catch(() => ({\n        error: res.statusText\n      }));\n      throw new Error(err.error || `HTTP ${res.status}`);\n    }\n    return await res.json();\n  } catch (err) {\n    clearTimeout(timer);\n    if (err.name === 'AbortError') throw new Error('Request timed out (30s)');\n    throw err;\n  }\n}\nconst mockDelay = (ms = 2000) => new Promise(r => setTimeout(r, ms));\n\n// ── POST /api/optimize-kitting ────────────────────────────────\n// Handles BOTH old schema (no material/area) and new Go schema\n// so React works before and after you connect the real backend\nexport async function runOptimization(items) {\n  if (MOCK_MODE) {\n    await mockDelay(1800);\n    const totalQty = items.reduce((s, i) => s + Number(i.quantity), 0);\n\n    // Group by dimensions + material (matches new Go grouping logic)\n    const groups = {};\n    items.forEach(item => {\n      const mat = item.material || 'Steel';\n      const key = `${mat}|${Number(item.length).toFixed(1)}x${Number(item.width).toFixed(1)}`;\n      if (!groups[key]) groups[key] = {\n        elements: [],\n        qty: 0,\n        material: mat\n      };\n      groups[key].elements.push(item.element_id);\n      groups[key].qty += Number(item.quantity);\n    });\n\n    // Material-aware repetition limits (mirrors Go constants)\n    const limits = {\n      Aluform: 100,\n      Plywood: 15,\n      Steel: 10\n    };\n    const kit_details = Object.entries(groups).map(([dims, g]) => {\n      var _limits$g$material;\n      const limit = (_limits$g$material = limits[g.material]) !== null && _limits$g$material !== void 0 ? _limits$g$material : 10;\n      const reqQty = Math.ceil(g.qty / limit);\n      return {\n        dimensions: dims,\n        material: g.material,\n        required_qty: reqQty,\n        repetition_count: Math.round(g.qty / reqQty * 100) / 100,\n        used_in_elements: g.elements\n      };\n    });\n    const optimizedTotal = kit_details.reduce((s, k) => s + k.required_qty, 0);\n    const savings = totalQty > 0 ? Math.round((totalQty - optimizedTotal) / totalQty * 100 * 100) / 100 : 0;\n    return {\n      original_boq_items: totalQty,\n      optimized_kits_required: optimizedTotal,\n      total_repetition_factor: Math.round(totalQty / Math.max(optimizedTotal, 1) * 100) / 100,\n      estimated_cost_savings_percent: savings,\n      execution_time_ms: '0.842 ms',\n      // mock Go speed\n      kit_details,\n      _run_id: `RUN-${Date.now()}`,\n      _processed_at: new Date().toISOString()\n    };\n  }\n  return apiFetch(ENDPOINTS.OPTIMIZE, {\n    method: 'POST',\n    body: JSON.stringify({\n      items\n    })\n  });\n}\n\n// ── GET /api/history ──────────────────────────────────────────\nexport async function fetchHistory() {\n  if (MOCK_MODE) {\n    await mockDelay(400);\n    return RUN_HISTORY;\n  }\n  return apiFetch(ENDPOINTS.HISTORY);\n}\n\n// ── GET /api/inventory ────────────────────────────────────────\nexport async function fetchInventory() {\n  if (MOCK_MODE) {\n    await mockDelay(400);\n    return INVENTORY_DATA;\n  }\n  return apiFetch(ENDPOINTS.INVENTORY);\n}\n\n// ── GET /api/health ───────────────────────────────────────────\nexport async function checkHealth() {\n  if (MOCK_MODE) {\n    await mockDelay(150);\n    return {\n      status: 'ok',\n      version: '1.0.0-mock',\n      mode: 'mock'\n    };\n  }\n  return apiFetch(ENDPOINTS.HEALTH);\n}","map":{"version":3,"names":["MOCK_OPTIMIZATION_RESULT","RUN_HISTORY","INVENTORY_DATA","MOCK_MODE","BASE","TIMEOUT","ENDPOINTS","OPTIMIZE","HISTORY","INVENTORY","HEALTH","apiFetch","endpoint","options","controller","AbortController","timer","setTimeout","abort","res","fetch","headers","signal","clearTimeout","ok","err","json","catch","error","statusText","Error","status","name","mockDelay","ms","Promise","r","runOptimization","items","totalQty","reduce","s","i","Number","quantity","groups","forEach","item","mat","material","key","length","toFixed","width","elements","qty","push","element_id","limits","Aluform","Plywood","Steel","kit_details","Object","entries","map","dims","g","_limits$g$material","limit","reqQty","Math","ceil","dimensions","required_qty","repetition_count","round","used_in_elements","optimizedTotal","k","savings","original_boq_items","optimized_kits_required","total_repetition_factor","max","estimated_cost_savings_percent","execution_time_ms","_run_id","Date","now","_processed_at","toISOString","method","body","JSON","stringify","fetchHistory","fetchInventory","checkHealth","version","mode"],"sources":["C:/Users/JOEL DSILVA/OneDrive/Desktop/Projects/BoQ_Formwork_Fitting/obsidian-core/src/services/api.js"],"sourcesContent":["import { MOCK_OPTIMIZATION_RESULT, RUN_HISTORY, INVENTORY_DATA } from '../data/constants.js'\n\nconst MOCK_MODE = true        // ← set false when Go server is running\nconst BASE      = 'http://localhost:3000'\nconst TIMEOUT   = 30000\n\nconst ENDPOINTS = {\n  OPTIMIZE:  '/api/optimize-kitting',\n  HISTORY:   '/api/history',\n  INVENTORY: '/api/inventory',\n  HEALTH:    '/api/health',\n}\n\nasync function apiFetch(endpoint, options = {}) {\n  const controller = new AbortController()\n  const timer = setTimeout(() => controller.abort(), TIMEOUT)\n  try {\n    const res = await fetch(`${BASE}${endpoint}`, {\n      headers: { 'Content-Type': 'application/json' },\n      signal: controller.signal,\n      ...options,\n    })\n    clearTimeout(timer)\n    if (!res.ok) {\n      const err = await res.json().catch(() => ({ error: res.statusText }))\n      throw new Error(err.error || `HTTP ${res.status}`)\n    }\n    return await res.json()\n  } catch (err) {\n    clearTimeout(timer)\n    if (err.name === 'AbortError') throw new Error('Request timed out (30s)')\n    throw err\n  }\n}\n\nconst mockDelay = (ms = 2000) => new Promise(r => setTimeout(r, ms))\n\n// ── POST /api/optimize-kitting ────────────────────────────────\n// Handles BOTH old schema (no material/area) and new Go schema\n// so React works before and after you connect the real backend\nexport async function runOptimization(items) {\n  if (MOCK_MODE) {\n    await mockDelay(1800)\n\n    const totalQty = items.reduce((s, i) => s + Number(i.quantity), 0)\n\n    // Group by dimensions + material (matches new Go grouping logic)\n    const groups = {}\n    items.forEach(item => {\n      const mat = item.material || 'Steel'\n      const key = `${mat}|${Number(item.length).toFixed(1)}x${Number(item.width).toFixed(1)}`\n      if (!groups[key]) groups[key] = { elements: [], qty: 0, material: mat }\n      groups[key].elements.push(item.element_id)\n      groups[key].qty += Number(item.quantity)\n    })\n\n    // Material-aware repetition limits (mirrors Go constants)\n    const limits = { Aluform: 100, Plywood: 15, Steel: 10 }\n\n    const kit_details = Object.entries(groups).map(([dims, g]) => {\n      const limit  = limits[g.material] ?? 10\n      const reqQty = Math.ceil(g.qty / limit)\n      return {\n        dimensions:       dims,\n        material:         g.material,\n        required_qty:     reqQty,\n        repetition_count: Math.round((g.qty / reqQty) * 100) / 100,\n        used_in_elements: g.elements,\n      }\n    })\n\n    const optimizedTotal = kit_details.reduce((s, k) => s + k.required_qty, 0)\n    const savings = totalQty > 0\n      ? Math.round(((totalQty - optimizedTotal) / totalQty) * 100 * 100) / 100\n      : 0\n\n    return {\n      original_boq_items:              totalQty,\n      optimized_kits_required:         optimizedTotal,\n      total_repetition_factor:         Math.round((totalQty / Math.max(optimizedTotal, 1)) * 100) / 100,\n      estimated_cost_savings_percent:  savings,\n      execution_time_ms:               '0.842 ms',   // mock Go speed\n      kit_details,\n      _run_id:       `RUN-${Date.now()}`,\n      _processed_at: new Date().toISOString(),\n    }\n  }\n\n  return apiFetch(ENDPOINTS.OPTIMIZE, {\n    method: 'POST',\n    body: JSON.stringify({ items }),\n  })\n}\n\n// ── GET /api/history ──────────────────────────────────────────\nexport async function fetchHistory() {\n  if (MOCK_MODE) { await mockDelay(400); return RUN_HISTORY }\n  return apiFetch(ENDPOINTS.HISTORY)\n}\n\n// ── GET /api/inventory ────────────────────────────────────────\nexport async function fetchInventory() {\n  if (MOCK_MODE) { await mockDelay(400); return INVENTORY_DATA }\n  return apiFetch(ENDPOINTS.INVENTORY)\n}\n\n// ── GET /api/health ───────────────────────────────────────────\nexport async function checkHealth() {\n  if (MOCK_MODE) {\n    await mockDelay(150)\n    return { status: 'ok', version: '1.0.0-mock', mode: 'mock' }\n  }\n  return apiFetch(ENDPOINTS.HEALTH)\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}